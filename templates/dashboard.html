{% extends "base.html" %} {% block title %}Dashboard{% endblock %} {% block content %}

<div class="card">
  <div class="card-body">
    <h2 class="mb-4">Convert JSON</h2>
    <form id="convert-form" class="m-0" method="post" action="/convert" enctype="multipart/form-data">
      <div class="d-flex flex-column gap-3">
        <!-- JSON from S3 -->
        <div>
          <label class="form-label" for="json_key">JSON file from S3:</label>
          <select id="json_key" class="form-select" name="json_key" required>
            <option value="" disabled selected>Select a JSON file</option>
            {% for f in json_files %}
            <option value="{{ f.key }}">{{ f.name }}</option>
            {% endfor %}
          </select>
        </div>
        <div>
          <label class="form-label" for="pdf">PDF file:</label>
          <input id="pdf" class="form-control" type="file" name="pdf" accept=".pdf" required />
        </div>

        <!-- Images + categories -->
        <div>
          <label class="form-label">Images:</label>
          <div id="images-container" class="d-flex flex-column gap-2 mb-2">
            <div class="image-row d-flex gap-2 align-items-center">
              <select class="form-select" name="categories" required readonly>
                <option value="coverPhoto" selected>Borítókép</option>
              </select>
              <input class="form-control" type="file" name="images" accept=".jpg,.jpeg,.png" required />
              <input class="form-control" name="notes" required value="Kép az ingatlanról" />
            </div>
            <div class="image-row d-flex gap-2 align-items-center">
              <select class="form-select" name="categories" required readonly>
                <option value="facade" selected>Homlokzat</option>
              </select>
              <input class="form-control" type="file" name="images" accept=".jpg,.jpeg,.png" required />
              <input class="form-control" name="notes" required value="Bejárati homlokzat" />
            </div>
            <div class="image-row d-flex gap-2 align-items-center">
              <select class="form-select" name="categories" required readonly>
                <option value="characteristicHeatExchanger" selected>Jellemző hőleadó és annak szabályozása</option>
              </select>
              <input class="form-control" type="file" name="images" accept=".jpg,.jpeg,.png" required />
              <input class="form-control" name="notes" required value="Jellemző hőleadó" />
            </div>
            <div class="image-row d-flex gap-2 align-items-center">
              <select class="form-select" name="categories" required readonly>
                <option value="characteristicHeatExchanger" selected>Jellemző hőleadó és annak szabályozása</option>
              </select>
              <input class="form-control" type="file" name="images" accept=".jpg,.jpeg,.png" required />
              <input class="form-control" name="notes" required value="Termosztát" />
            </div>
            <div class="image-row d-flex gap-2 align-items-center">
              <select class="form-select" name="categories" required readonly>
                <option value="characteristicOpeningStructure" selected>Jellemző nyílászáró</option>
              </select>
              <input class="form-control" type="file" name="images" accept=".jpg,.jpeg,.png" required />
              <input class="form-control" name="notes" required value="Jellemző ablak" />
            </div>
            <div class="image-row d-flex gap-2 align-items-center">
              <select class="form-select" name="categories" required readonly>
                <option value="characteristicOpeningStructure" selected>Jellemző nyílászáró</option>
              </select>
              <input class="form-control" type="file" name="images" accept=".jpg,.jpeg,.png" required />
              <input class="form-control" name="notes" required value="Bejárati ajtó" />
            </div>
            <div class="image-row d-flex gap-2 align-items-center">
              <select class="form-select" name="categories" required readonly>
                <option value="characteristicOpeningStructure" selected>Jellemző nyílászáró</option>
              </select>
              <input class="form-control" type="file" name="images" accept=".jpg,.jpeg,.png" required />
              <input class="form-control" name="notes" required value="Terasz ajtó" />
            </div>
            <div class="image-row d-flex gap-2 align-items-center">
              <select class="form-select" name="categories" required readonly>
                <option value="heatGeneratorAndHeatStorageSituation" selected>Hőtermelő és a hőtároló helyzete</option>
              </select>
              <input class="form-control" type="file" name="images" accept=".jpg,.jpeg,.png" required />
              <input class="form-control" name="notes" required value="Kazán" />
            </div>
            <div class="image-row d-flex gap-2 align-items-center">
              <select class="form-select" name="categories" required readonly>
                <option value="heatGeneratorAndHeatStorageSituation" selected>Hőtermelő és a hőtároló helyzete</option>
              </select>
              <input class="form-control" type="file" name="images" accept=".jpg,.jpeg,.png" required />
              <input class="form-control" name="notes" required value="Bojler" />
            </div>
          </div>
          <button type="button" id="add-image-btn" class="btn btn-outline-secondary btn-sm mt-2">+ Add image</button>
        </div>

        <button class="btn btn-primary text-nowrap w-100" type="submit">Convert JSON</button>
      </div>
    </form>
  </div>
</div>

<script>
  (function () {
    const container = document.getElementById('images-container');
    const addBtn = document.getElementById('add-image-btn');

    function createImageRow() {
      const row = document.createElement('div');
      row.className = 'image-row d-flex gap-2 align-items-center';

      row.innerHTML = `
        <select class="form-select" name="categories" required>
          <option value="" disabled selected>Select category</option>
          <option value="coverPhoto">Borítókép</option>
          <option value="facade">Homlokzat</option>
          <option value="characteristicHeatExchanger">Jellemző hőleadó és annak szabályozása</option>
          <option value="characteristicOpeningStructure">Jellemző nyílászáró</option>
          <option value="heatGeneratorAndHeatStorageSituation">Hőtermelő és a hőtároló helyzete</option>
          <option value="renewableEnergyUtilizerSystem">Megújuló energiát hasznosító rendszer</option>
          <option value="other">Egyéb</option>
        </select>
        <input class="form-control" type="file" name="images" accept=".jpg,.jpeg,.png" required />
        <input class="form-control" name="notes" required />
        <button type="button" class="btn btn-outline-danger btn-sm remove-image-btn">
          &times;
        </button>
      `;

      // hook up remove button
      row.querySelector('.remove-image-btn').addEventListener('click', function () {
        container.removeChild(row);
      });

      return row;
    }

    // Add new image row
    addBtn.addEventListener('click', function () {
      container.appendChild(createImageRow());
    });
  })();
</script>

{% endblock %}
